# Правила разработки кода для LLM-ассистента

Данный документ содержит правила и соглашения для разработки кода проекта LLM-ассистента. Эти правила основаны на техническом видении проекта, описанном в [@vision.md](vision.md).

## Основные принципы

- **KISS** - пишите максимально простой код, избегайте сложных решений
- **Функциональный подход** - используйте функции вместо классов
- **Модульность** - разделяйте код на логические компоненты с четкой ответственностью
- **Минимализм** - реализуйте только необходимый функционал для MVP

## Структура кода

- Следуйте структуре проекта, описанной в [@vision.md](vision.md)
- Размещайте код в соответствующих модулях:
  - `bot/` - взаимодействие с Telegram API
  - `llm/` - взаимодействие с LLM API
  - `tests/` - тесты

## Стиль кода

- **Форматирование**: PEP 8
- **Именование**:
  - Функции: `snake_case` с глаголами (`get_llm_response`, `process_message`)
  - Переменные: `snake_case` с существительными (`user_message`, `dialog_history`)
  - Константы: `UPPER_SNAKE_CASE` (`SYSTEM_PROMPT`, `MAX_TOKENS`)
- **Документация**:
  - Добавляйте docstrings к функциям (описание, параметры, возвращаемое значение)
  - Комментируйте сложные участки кода

## Работа с данными

- Используйте только встроенные структуры данных Python (`dict`, `list`)
- Следуйте структуре модели данных из [@vision.md](vision.md)
- Не используйте базы данных или внешние хранилища

## Обработка ошибок

- Добавляйте обработку исключений для критических операций
- Логируйте ошибки с достаточным контекстом для отладки
- Предоставляйте пользователю понятные сообщения об ошибках

## Асинхронность

- Используйте `async`/`await` для работы с Telegram API и LLM API
- Избегайте блокирующих операций в основном потоке

## Тестирование

- Пишите тесты для основной функциональности
- Используйте моки для внешних зависимостей (Telegram API, LLM API)
- Следуйте принципу "один тест - одна функциональность"

## Конфигурация

- Все настройки должны загружаться из переменных окружения через `.env`
- Не храните секреты в коде
- Используйте значения по умолчанию для необязательных параметров

## Логирование

- Используйте стандартный модуль `logging`
- Логируйте важные события и ошибки
- Включайте контекст в сообщения логов (chat_id, timestamp)

## Работа с LLM

- Следуйте подходу к работе с LLM, описанному в [@vision.md](vision.md)
- Используйте OpenRouter API через OpenAI клиент
- Обрабатывайте ошибки API и таймауты

## Мониторинг

- Реализуйте базовое логирование запросов и ответов LLM
- Отслеживайте ошибки взаимодействия с API

## Деплой

- Используйте Docker для упаковки приложения
- Следуйте подходу к деплою из [@vision.md](vision.md)
- Убедитесь, что конфигурация работает в контейнере