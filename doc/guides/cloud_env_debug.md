# Проверка переменных окружения в облачном хранилище

## Проблема
У вас есть токен Hugging Face, но он не работает в облачном хранилище. Это может быть связано с неправильной настройкой переменных окружения.

## Диагностика

### 1. Проверьте логи бота
После добавления отладочной информации в код, перезапустите бота и проверьте логи. Вы должны увидеть:

```
=== ПРОВЕРКА ПЕРЕМЕННЫХ ОКРУЖЕНИЯ ===
TELEGRAM_BOT_TOKEN: ДА
OPENROUTER_API_KEY: ДА
HUGGINGFACE_API_TOKEN: ДА/НЕТ
LLM_MODEL: mistralai/mistral-7b-instruct:free
VISION_MODEL: google/gemini-flash-1.5
=====================================
```

### 2. Проверьте настройки в облачном хранилище

#### Railway
1. Зайдите в панель управления Railway
2. Выберите ваш проект
3. Перейдите в раздел "Variables"
4. Убедитесь, что есть переменная `HUGGINGFACE_API_TOKEN`
5. Проверьте, что значение токена правильное (начинается с `hf_`)

#### Heroku
1. Зайдите в панель управления Heroku
2. Выберите ваше приложение
3. Перейдите в раздел "Settings" → "Config Vars"
4. Убедитесь, что есть переменная `HUGGINGFACE_API_TOKEN`
5. Проверьте, что значение токена правильное

#### Docker (локально)
Если используете Docker локально:
```bash
# Проверьте, что файл .env существует и содержит токен
cat .env | grep HUGGINGFACE_API_TOKEN

# Перезапустите контейнер
make docker-stop
make docker-run
```

### 3. Возможные проблемы

#### Проблема 1: Токен не установлен
**Симптом:** В логах `HUGGINGFACE_API_TOKEN: НЕТ`
**Решение:** Добавьте переменную в настройки облачного хранилища

#### Проблема 2: Токен неправильный
**Симптом:** В логах `HUGGINGFACE_API_TOKEN: ДА`, но ошибки API
**Решение:** 
1. Проверьте, что токен начинается с `hf_`
2. Убедитесь, что токен имеет права "Read"
3. Создайте новый токен, если старый не работает

#### Проблема 3: Токен установлен, но не работает
**Симптом:** В логах `HUGGINGFACE_API_TOKEN: ДА`, но ошибки при транскрипции
**Решение:**
1. Проверьте, что модель `openai/whisper-large-v3` доступна
2. Убедитесь, что у вас есть кредиты на Hugging Face
3. Попробуйте другую модель: `openai/whisper-base`

### 4. Альтернативные модели Whisper

Если основная модель не работает, попробуйте изменить в коде:

```python
# В llm/speech_client.py, строка 37
self.api_url = "https://api-inference.huggingface.co/models/openai/whisper-base"
```

Доступные модели:
- `openai/whisper-base` - быстрее, меньше точность
- `openai/whisper-small` - средняя скорость и точность  
- `openai/whisper-medium` - медленнее, лучше точность
- `openai/whisper-large-v3` - самая точная, но медленная

### 5. Тестирование

После исправления:
1. Перезапустите бота
2. Отправьте голосовое сообщение
3. Проверьте логи на наличие ошибок
4. Если ошибок нет, голосовые сообщения должны работать

## Если ничего не помогает

Если проблема остается, можно временно отключить голосовые сообщения:

1. Удалите переменную `HUGGINGFACE_API_TOKEN` из настроек
2. Перезапустите бота
3. Бот будет работать с текстом и изображениями, но без голосовых сообщений
